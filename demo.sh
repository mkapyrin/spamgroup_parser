#!/bin/bash

# Demo Script - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ø–∞—Ä—Å–µ—Ä–∞

set -e

PROJECT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$PROJECT_DIR"

echo "üé¨ Telegram Group Parser - –ü–æ–ª–Ω–∞—è –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è"
echo "=============================================="
echo ""

# –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo "1Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
if [ ! -d "venv" ]; then
    echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º setup..."
    ./setup.sh
    echo ""
fi

# –®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
echo "2Ô∏è‚É£  –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏–º–µ—Ä–∞ CSV —Ñ–∞–π–ª–∞..."
source venv/bin/activate
python utils.py analyze --input input/sample.csv
echo ""

# –®–∞–≥ 3: –û—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–∞ (–¥–µ–º–æ)
echo "3Ô∏è‚É£  –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö..."
python utils.py clean --input input/sample.csv --output input/sample_cleaned.csv
echo ""

# –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo "4Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
if python main.py --check-config 2>/dev/null; then
    echo "‚úÖ API –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
    echo ""
    
    # –®–∞–≥ 5: –î–µ–º–æ –∑–∞–ø—É—Å–∫ (–µ—Å–ª–∏ API –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
    echo "5Ô∏è‚É£  –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞..."
    echo "‚ö†Ô∏è  –≠—Ç–æ –∑–∞–π–º–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Telegram"
    read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/N): " -n 1 -r
    echo
    
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Å–µ—Ä..."
        python main.py --input input/sample.csv --verbose
    else
        echo "‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫"
    fi
else
    echo "‚ö†Ô∏è  API –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω - –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–µ–∑ –∑–∞–ø—É—Å–∫–∞"
    echo ""
    
    echo "üìù –î–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:"
    echo "1. –ü–æ–ª—É—á–∏—Ç–µ API –¥–∞–Ω–Ω—ã–µ: https://my.telegram.org"
    echo "2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env.example –≤ .env"
    echo "3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ API_ID, API_HASH, PHONE"
    echo "4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: ./run.sh"
fi

echo ""
echo "6Ô∏è‚É£  –û–±–∑–æ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞..."
echo "üìÅ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:"
tree -L 2 -a 2>/dev/null || ls -la

echo ""
echo "üìã Available Makefiles commands:"
make help 2>/dev/null || echo "  (make –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞–ø—Ä—è–º—É—é)"

echo ""
echo "üéâ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "========================="
echo ""
echo "üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "  ./setup.sh                   # –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞"
echo "  ./test.sh                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏" 
echo "  ./copy_csv.sh file.csv       # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞"
echo "  ./run.sh                     # –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞"
echo "  ./run.sh --verbose           # –ü–æ–¥—Ä–æ–±–Ω—ã–π –∑–∞–ø—É—Å–∫"
echo "  python utils.py analyze -i file.csv  # –ê–Ω–∞–ª–∏–∑ CSV"
echo ""
echo "üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: README.md"
